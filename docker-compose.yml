version: '3.8'

services:
  # ----------------------------------------------------------------------
  # PHP-FPM Service (The Laravel Application)
  # ----------------------------------------------------------------------
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: laravel-app
    restart: unless-stopped
    # Sets the base directory for subsequent commands
    working_dir: /var/www
    # Mounts the current project directory into the container
    volumes:
      - ./:/var/www
    networks:
      - laravel-network

  # ----------------------------------------------------------------------
  # Nginx Service (The Web Server)
  # ----------------------------------------------------------------------
  nginx:
    image: nginx:alpine
    container_name: laravel-nginx
    restart: unless-stopped
    # Exposes container port 80 to host port 8080
    ports:
      - "8080:80"
    volumes:
      # Mounts the project code
      - ./:/var/www
      # Mounts the custom Nginx configuration file
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
    # Ensures the PHP-FPM service is running before Nginx starts
    depends_on:
      - app
    networks:
      - laravel-network

# ----------------------------------------------------------------------
# Define Networks (Volumes section is removed as it was only for MySQL)
# ----------------------------------------------------------------------
networks:
  laravel-network:
    driver: bridge